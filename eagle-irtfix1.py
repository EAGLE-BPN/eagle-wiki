# -*- coding: utf-8 -*-

"""

Accepted options:
	
	-dry
		Dry run: don't edit the wiki, but process and print all the data.
		It's useful together with -always to check for crashes in the script before launching the bot.
		
	-always
		Don't ask for confirmation before submitting a new item to the wiki.
		
	-start:<IRT>
		Start from file "<IRT>.xml". Useful for resuming an interrupted import.

"""

"""
This modification of the eagle-irt.py file is made to fix the existing items 

the issue rised on 13 July by F. Bigi was that translations appeared to be truncated
that was related to the path pointing to div[@type='translation']/p rather than at the whole 
div.

the code checks the list of items in the wiki and compares the new text to the one initially uploaded
then allows the user to make a decision.

the Translation text at the beinning was avoided by starting the comparison from index 12, 
but this is not always true, as not always the markup as a space.
further inconsistencies relate to the source data.

"""

import pywikibot, os, re, csv
import xml.etree.ElementTree as ET

irt = {'IRT001': 'Q56',
'IRT002': 'Q57',
'IRT003': 'Q58',
'IRT004': 'Q59',
'IRT005': 'Q60',
'IRT006': 'Q61',
'IRT007': 'Q62',
'IRT008': 'Q63',
'IRT009': 'Q64',
'IRT010': 'Q65',
'IRT011': 'Q66',
'IRT012': 'Q67',
'IRT013': 'Q68',
'IRT014': 'Q69',
'IRT015': 'Q70',
'IRT016': 'Q71',
'IRT017': 'Q72',
'IRT018': 'Q73',
'IRT019': 'Q74',
'IRT020': 'Q75',
'IRT021': 'Q76',
'IRT022': 'Q77',
'IRT023': 'Q78',
'IRT024': 'Q79',
'IRT025': 'Q80',
'IRT026': 'Q81',
'IRT027': 'Q82',
'IRT028': 'Q83',
'IRT029': 'Q84',
'IRT030': 'Q85',
'IRT031': 'Q86',
'IRT032': 'Q87',
'IRT033': 'Q88',
'IRT034': 'Q89',
'IRT035': 'Q90',
'IRT036': 'Q91',
'IRT037': 'Q92',
'IRT038': 'Q93',
'IRT039': 'Q94',
'IRT040': 'Q95',
'IRT041': 'Q96',
'IRT042': 'Q97',
'IRT043': 'Q98',
'IRT044': 'Q99',
'IRT045': 'Q100',
'IRT046': 'Q101',
'IRT047': 'Q102',
'IRT048': 'Q103',
'IRT049': 'Q104',
'IRT050': 'Q105',
'IRT051': 'Q106',
'IRT052': 'Q107',
'IRT053': 'Q108',
'IRT054': 'Q109',
'IRT055': 'Q110',
'IRT056': 'Q111',
'IRT057': 'Q112',
'IRT058': 'Q113',
'IRT059': 'Q114',
'IRT060': 'Q115',
'IRT061': 'Q116',
'IRT062': 'Q117',
'IRT063': 'Q118',
'IRT064': 'Q119',
'IRT065': 'Q120',
'IRT066': 'Q121',
'IRT067': 'Q122',
'IRT068': 'Q123',
'IRT069': 'Q124',
'IRT070': 'Q125',
'IRT071': 'Q126',
'IRT072': 'Q127',
'IRT073': 'Q129',
'IRT074': 'Q130',
'IRT075': 'Q131',
'IRT075a': 'Q132',
'IRT076': 'Q133',
'IRT077': 'Q134',
'IRT078': 'Q135',
'IRT079': 'Q136',
'IRT080': 'Q137',
'IRT081': 'Q138',
'IRT082': 'Q139',
'IRT083': 'Q140',
'IRT084': 'Q141',
'IRT085': 'Q142',
'IRT086': 'Q143',
'IRT087': 'Q144',
'IRT088': 'Q145',
'IRT089': 'Q146',
'IRT090': 'Q147',
'IRT091': 'Q148',
'IRT092': 'Q149',
'IRT093': 'Q150',
'IRT094': 'Q151',
'IRT095': 'Q152',
'IRT096': 'Q153',
'IRT097': 'Q154',
'IRT098': 'Q155',
'IRT099': 'Q156',
'IRT100': 'Q157',
'IRT101': 'Q158',
'IRT102': 'Q159',
'IRT103': 'Q160',
'IRT104': 'Q161',
'IRT105': 'Q162',
'IRT106': 'Q163',
'IRT107': 'Q164',
'IRT108': 'Q165',
'IRT109': 'Q166',
'IRT110': 'Q167',
'IRT111': 'Q168',
'IRT112': 'Q169',
'IRT113': 'Q170',
'IRT114': 'Q171',
'IRT115': 'Q172',
'IRT116': 'Q173',
'IRT117': 'Q174',
'IRT118': 'Q175',
'IRT119': 'Q176',
'IRT120': 'Q177',
'IRT121': 'Q178',
'IRT122': 'Q179',
'IRT123': 'Q180',
'IRT124': 'Q181',
'IRT125': 'Q182',
'IRT126': 'Q183',
'IRT127': 'Q184',
'IRT128': 'Q185',
'IRT129': 'Q186',
'IRT130': 'Q187',
'IRT131': 'Q188',
'IRT132': 'Q189',
'IRT133': 'Q190',
'IRT134': 'Q191',
'IRT135': 'Q192',
'IRT136': 'Q193',
'IRT137': 'Q194',
'IRT138': 'Q195',
'IRT139': 'Q196',
'IRT140': 'Q197',
'IRT141': 'Q198',
'IRT142': 'Q199',
'IRT143': 'Q200',
'IRT144': 'Q201',
'IRT145': 'Q202',
'IRT146': 'Q203',
'IRT147': 'Q204',
'IRT148': 'Q205',
'IRT149': 'Q206',
'IRT150': 'Q207',
'IRT151': 'Q208',
'IRT152': 'Q209',
'IRT153': 'Q210',
'IRT154': 'Q212',
'IRT155': 'Q213',
'IRT156': 'Q214',
'IRT157': 'Q215',
'IRT158': 'Q216',
'IRT159': 'Q217',
'IRT160': 'Q218',
'IRT161': 'Q219',
'IRT162': 'Q220',
'IRT163': 'Q221',
'IRT164': 'Q222',
'IRT165': 'Q223',
'IRT166': 'Q224',
'IRT167': 'Q225',
'IRT168': 'Q226',
'IRT169': 'Q227',
'IRT170': 'Q228',
'IRT171': 'Q229',
'IRT172': 'Q230',
'IRT173': 'Q231',
'IRT174': 'Q232',
'IRT175': 'Q233',
'IRT176': 'Q234',
'IRT177': 'Q235',
'IRT178': 'Q236',
'IRT179': 'Q237',
'IRT180': 'Q238',
'IRT181': 'Q239',
'IRT182': 'Q240',
'IRT183': 'Q241',
'IRT184': 'Q242',
'IRT185': 'Q243',
'IRT186': 'Q244',
'IRT187': 'Q245',
'IRT188': 'Q246',
'IRT189': 'Q247',
'IRT190': 'Q248',
'IRT191': 'Q249',
'IRT192': 'Q250',
'IRT193': 'Q251',
'IRT194': 'Q252',
'IRT195': 'Q253',
'IRT196': 'Q254',
'IRT197': 'Q255',
'IRT198': 'Q256',
'IRT199': 'Q257',
'IRT200': 'Q258',
'IRT201': 'Q259',
'IRT202': 'Q260',
'IRT203': 'Q261',
'IRT204': 'Q262',
'IRT205': 'Q263',
'IRT206': 'Q264',
'IRT207': 'Q265',
'IRT208': 'Q266',
'IRT209': 'Q267',
'IRT210': 'Q268',
'IRT211': 'Q269',
'IRT212': 'Q270',
'IRT213': 'Q271',
'IRT214': 'Q272',
'IRT215': 'Q273',
'IRT216': 'Q274',
'IRT217': 'Q275',
'IRT218': 'Q276',
'IRT219': 'Q277',
'IRT220': 'Q278',
'IRT221': 'Q279',
'IRT222': 'Q280',
'IRT223': 'Q281',
'IRT224': 'Q282',
'IRT225': 'Q283',
'IRT226': 'Q284',
'IRT227': 'Q285',
'IRT228': 'Q286',
'IRT229': 'Q287',
'IRT230': 'Q288',
'IRT231': 'Q289',
'IRT232': 'Q290',
'IRT233': 'Q291',
'IRT234': 'Q292',
'IRT235': 'Q293',
'IRT236': 'Q294',
'IRT237': 'Q295',
'IRT238': 'Q296',
'IRT239': 'Q297',
'IRT240': 'Q298',
'IRT241': 'Q299',
'IRT242': 'Q300',
'IRT243': 'Q301',
'IRT244': 'Q302',
'IRT245': 'Q303',
'IRT246': 'Q304',
'IRT247': 'Q305',
'IRT248': 'Q306',
'IRT249': 'Q307',
'IRT250': 'Q308',
'IRT251': 'Q309',
'IRT252': 'Q310',
'IRT253': 'Q311',
'IRT253a': 'Q312',
'IRT254': 'Q313',
'IRT255': 'Q314',
'IRT256': 'Q315',
'IRT256a': 'Q316',
'IRT257': 'Q317',
'IRT258': 'Q318',
'IRT259': 'Q319',
'IRT260': 'Q320',
'IRT263': 'Q321',
'IRT264': 'Q322',
'IRT265': 'Q323',
'IRT266': 'Q324',
'IRT267': 'Q325',
'IRT268': 'Q326',
'IRT269': 'Q327',
'IRT270': 'Q328',
'IRT271': 'Q329',
'IRT272': 'Q330',
'IRT273': 'Q331',
'IRT274': 'Q332',
'IRT275': 'Q333',
'IRT276': 'Q334',
'IRT277': 'Q335',
'IRT278': 'Q336',
'IRT279': 'Q337',
'IRT280': 'Q338',
'IRT281': 'Q339',
'IRT282': 'Q340',
'IRT283': 'Q341',
'IRT284': 'Q342',
'IRT285': 'Q343',
'IRT286': 'Q344',
'IRT287': 'Q345',
'IRT288': 'Q346',
'IRT289': 'Q348',
'IRT290': 'Q349',
'IRT291': 'Q350',
'IRT292': 'Q351',
'IRT293': 'Q352',
'IRT294': 'Q353',
'IRT295': 'Q354',
'IRT296': 'Q355',
'IRT297': 'Q356',
'IRT298': 'Q357',
'IRT299': 'Q358',
'IRT300': 'Q359',
'IRT301': 'Q360',
'IRT302': 'Q361',
'IRT303': 'Q362',
'IRT304': 'Q363',
'IRT305': 'Q364',
'IRT306': 'Q365',
'IRT307': 'Q366',
'IRT308': 'Q367',
'IRT309': 'Q368',
'IRT310': 'Q369',
'IRT310a': 'Q370',
'IRT311': 'Q371',
'IRT312': 'Q372',
'IRT313': 'Q373',
'IRT314': 'Q374',
'IRT315': 'Q375',
'IRT315a': 'Q376',
'IRT316': 'Q377',
'IRT317': 'Q378',
'IRT318': 'Q379',
'IRT319': 'Q380',
'IRT320': 'Q381',
'IRT321': 'Q382',
'IRT322': 'Q383',
'IRT323': 'Q384',
'IRT324': 'Q385',
'IRT325': 'Q386',
'IRT326': 'Q387',
'IRT327': 'Q388',
'IRT328': 'Q389',
'IRT329': 'Q390',
'IRT330': 'Q391',
'IRT331': 'Q392',
'IRT332': 'Q393',
'IRT333': 'Q394',
'IRT334': 'Q395',
'IRT335': 'Q396',
'IRT336': 'Q397',
'IRT337': 'Q398',
'IRT338': 'Q399',
'IRT339': 'Q400',
'IRT340': 'Q401',
'IRT341': 'Q402',
'IRT342': 'Q403',
'IRT343': 'Q404',
'IRT344': 'Q405',
'IRT345': 'Q406',
'IRT346': 'Q407',
'IRT347': 'Q408',
'IRT348': 'Q409',
'IRT349': 'Q410',
'IRT349a': 'Q411',
'IRT350': 'Q412',
'IRT351': 'Q413',
'IRT352': 'Q414',
'IRT353': 'Q415',
'IRT354': 'Q416',
'IRT355': 'Q417',
'IRT356': 'Q418',
'IRT357': 'Q419',
'IRT358': 'Q420',
'IRT359': 'Q421',
'IRT360': 'Q422',
'IRT361': 'Q423',
'IRT362': 'Q424',
'IRT363': 'Q425',
'IRT364': 'Q426',
'IRT365': 'Q427',
'IRT366': 'Q428',
'IRT367': 'Q429',
'IRT368': 'Q430',
'IRT369': 'Q431',
'IRT370': 'Q432',
'IRT371': 'Q433',
'IRT372': 'Q434',
'IRT373': 'Q435',
'IRT374': 'Q436',
'IRT375': 'Q437',
'IRT376': 'Q438',
'IRT377': 'Q439',
'IRT378': 'Q440',
'IRT379': 'Q441',
'IRT380': 'Q442',
'IRT381': 'Q443',
'IRT382': 'Q444',
'IRT383': 'Q445',
'IRT384': 'Q446',
'IRT385': 'Q447',
'IRT386': 'Q448',
'IRT387': 'Q449',
'IRT388': 'Q450',
'IRT389': 'Q451',
'IRT390': 'Q452',
'IRT391': 'Q453',
'IRT392': 'Q454',
'IRT393': 'Q455',
'IRT394': 'Q456',
'IRT395': 'Q457',
'IRT396': 'Q458',
'IRT397': 'Q459',
'IRT398': 'Q460',
'IRT398a': 'Q461',
'IRT399': 'Q462',
'IRT400': 'Q463',
'IRT401': 'Q464',
'IRT402': 'Q465',
'IRT403': 'Q466',
'IRT404': 'Q467',
'IRT405': 'Q468',
'IRT406': 'Q469',
'IRT407': 'Q470',
'IRT408': 'Q471',
'IRT409': 'Q472',
'IRT410': 'Q473',
'IRT411': 'Q474',
'IRT412': 'Q475',
'IRT413': 'Q476',
'IRT414': 'Q477',
'IRT415': 'Q478',
'IRT416': 'Q479',
'IRT417': 'Q480',
'IRT418': 'Q481',
'IRT419': 'Q482',
'IRT420': 'Q483',
'IRT421': 'Q484',
'IRT422': 'Q485',
'IRT423': 'Q486',
'IRT424': 'Q487',
'IRT425': 'Q488',
'IRT426': 'Q489',
'IRT427': 'Q490',
'IRT428': 'Q491',
'IRT429': 'Q492',
'IRT430': 'Q493',
'IRT431': 'Q494',
'IRT432': 'Q495',
'IRT433': 'Q496',
'IRT434': 'Q497',
'IRT435': 'Q498',
'IRT436': 'Q499',
'IRT437': 'Q500',
'IRT438': 'Q501',
'IRT439': 'Q502',
'IRT440': 'Q503',
'IRT441': 'Q504',
'IRT442': 'Q505',
'IRT443': 'Q506',
'IRT444': 'Q507',
'IRT445': 'Q508',
'IRT446': 'Q509',
'IRT447': 'Q510',
'IRT448': 'Q511',
'IRT449': 'Q512',
'IRT450': 'Q513',
'IRT451': 'Q514',
'IRT452': 'Q515',
'IRT453': 'Q516',
'IRT454': 'Q517',
'IRT455': 'Q518',
'IRT456': 'Q519',
'IRT457': 'Q520',
'IRT458': 'Q521',
'IRT459': 'Q522',
'IRT460': 'Q523',
'IRT461': 'Q524',
'IRT462': 'Q525',
'IRT463': 'Q526',
'IRT464': 'Q527',
'IRT465': 'Q528',
'IRT466': 'Q529',
'IRT467': 'Q530',
'IRT468': 'Q531',
'IRT469': 'Q532',
'IRT469a': 'Q533',
'IRT470': 'Q534',
'IRT471': 'Q535',
'IRT472': 'Q536',
'IRT473': 'Q537',
'IRT474': 'Q538',
'IRT475': 'Q539',
'IRT476': 'Q540',
'IRT477': 'Q541',
'IRT478': 'Q542',
'IRT479': 'Q543',
'IRT480': 'Q544',
'IRT481': 'Q545',
'IRT482': 'Q546',
'IRT483': 'Q547',
'IRT484': 'Q548',
'IRT485': 'Q549',
'IRT486': 'Q550',
'IRT487': 'Q551',
'IRT488': 'Q552',
'IRT489': 'Q553',
'IRT490': 'Q554',
'IRT491': 'Q555',
'IRT492': 'Q556',
'IRT493': 'Q557',
'IRT494': 'Q558',
'IRT495': 'Q559',
'IRT496': 'Q560',
'IRT497': 'Q561',
'IRT498': 'Q562',
'IRT499': 'Q563',
'IRT500': 'Q564',
'IRT501': 'Q565',
'IRT502': 'Q566',
'IRT503': 'Q567',
'IRT504': 'Q568',
'IRT505': 'Q569',
'IRT506': 'Q570',
'IRT507': 'Q571',
'IRT508': 'Q572',
'IRT509': 'Q573',
'IRT510': 'Q574',
'IRT511': 'Q575',
'IRT512': 'Q576',
'IRT513': 'Q577',
'IRT514': 'Q578',
'IRT515': 'Q579',
'IRT516': 'Q580',
'IRT517': 'Q581',
'IRT518': 'Q582',
'IRT519': 'Q583',
'IRT520': 'Q584',
'IRT521': 'Q585',
'IRT522': 'Q586',
'IRT523': 'Q587',
'IRT524': 'Q588',
'IRT525': 'Q589',
'IRT526': 'Q590',
'IRT527': 'Q591',
'IRT528': 'Q592',
'IRT529': 'Q593',
'IRT530': 'Q594',
'IRT531': 'Q595',
'IRT532': 'Q596',
'IRT533': 'Q597',
'IRT534': 'Q598',
'IRT535': 'Q599',
'IRT536': 'Q600',
'IRT537': 'Q601',
'IRT538': 'Q602',
'IRT539': 'Q603',
'IRT540': 'Q604',
'IRT541': 'Q605',
'IRT542': 'Q606',
'IRT543': 'Q607',
'IRT544': 'Q608',
'IRT545': 'Q609',
'IRT546': 'Q610',
'IRT547': 'Q611',
'IRT548': 'Q612',
'IRT549': 'Q613',
'IRT550': 'Q614',
'IRT551': 'Q615',
'IRT552': 'Q616',
'IRT553': 'Q617',
'IRT554': 'Q618',
'IRT555': 'Q619',
'IRT556': 'Q620',
'IRT557': 'Q621',
'IRT558': 'Q622',
'IRT559': 'Q623',
'IRT560': 'Q624',
'IRT561': 'Q625',
'IRT562': 'Q626',
'IRT563': 'Q627',
'IRT564': 'Q628',
'IRT565': 'Q629',
'IRT566': 'Q630',
'IRT567': 'Q631',
'IRT568': 'Q632',
'IRT569': 'Q633',
'IRT570': 'Q634',
'IRT571': 'Q635',
'IRT572': 'Q636',
'IRT573': 'Q637',
'IRT574': 'Q638',
'IRT575': 'Q639',
'IRT576': 'Q640',
'IRT577': 'Q641',
'IRT578': 'Q642',
'IRT579': 'Q643',
'IRT580': 'Q644',
'IRT581': 'Q645',
'IRT582': 'Q646',
'IRT583': 'Q647',
'IRT584': 'Q648',
'IRT585': 'Q649',
'IRT586': 'Q650',
'IRT587': 'Q651',
'IRT588': 'Q652',
'IRT589': 'Q653',
'IRT590': 'Q654',
'IRT591': 'Q655',
'IRT592': 'Q656',
'IRT593': 'Q657',
'IRT594': 'Q658',
'IRT595': 'Q659',
'IRT596': 'Q660',
'IRT597': 'Q661',
'IRT598': 'Q662',
'IRT599': 'Q663',
'IRT600': 'Q664',
'IRT601': 'Q665',
'IRT602': 'Q666',
'IRT603': 'Q667',
'IRT604': 'Q668',
'IRT605': 'Q669',
'IRT606': 'Q670',
'IRT607': 'Q671',
'IRT608': 'Q672',
'IRT609': 'Q673',
'IRT610': 'Q674',
'IRT611': 'Q675',
'IRT612': 'Q676',
'IRT613': 'Q677',
'IRT614': 'Q678',
'IRT615': 'Q679',
'IRT615a': 'Q680',
'IRT616': 'Q681',
'IRT617': 'Q682',
'IRT618': 'Q683',
'IRT619': 'Q684',
'IRT620': 'Q685',
'IRT621': 'Q686',
'IRT622': 'Q687',
'IRT623': 'Q688',
'IRT624': 'Q689',
'IRT625': 'Q690',
'IRT626': 'Q691',
'IRT627': 'Q692',
'IRT628': 'Q693',
'IRT629': 'Q694',
'IRT630': 'Q695',
'IRT631': 'Q696',
'IRT632': 'Q697',
'IRT633': 'Q698',
'IRT634': 'Q699',
'IRT635': 'Q700',
'IRT636': 'Q701',
'IRT637': 'Q702',
'IRT638': 'Q703',
'IRT639': 'Q704',
'IRT640': 'Q705',
'IRT641': 'Q706',
'IRT642': 'Q707',
'IRT643': 'Q708',
'IRT644': 'Q709',
'IRT645': 'Q710',
'IRT646': 'Q711',
'IRT647': 'Q712',
'IRT648': 'Q713',
'IRT649': 'Q714',
'IRT650': 'Q715',
'IRT651': 'Q716',
'IRT652': 'Q717',
'IRT653': 'Q718',
'IRT654': 'Q719',
'IRT655': 'Q720',
'IRT656': 'Q721',
'IRT657': 'Q722',
'IRT658': 'Q723',
'IRT659': 'Q724',
'IRT660': 'Q725',
'IRT661': 'Q726',
'IRT662': 'Q727',
'IRT663': 'Q728',
'IRT664': 'Q729',
'IRT665': 'Q730',
'IRT666': 'Q731',
'IRT667': 'Q732',
'IRT668': 'Q733',
'IRT669': 'Q734',
'IRT670': 'Q735',
'IRT671': 'Q736',
'IRT672': 'Q738',
'IRT673': 'Q739',
'IRT674': 'Q740',
'IRT675': 'Q741',
'IRT676': 'Q742',
'IRT677': 'Q743',
'IRT678': 'Q744',
'IRT679': 'Q745',
'IRT680': 'Q746',
'IRT681': 'Q747',
'IRT682': 'Q748',
'IRT683': 'Q749',
'IRT684': 'Q750',
'IRT685': 'Q751',
'IRT686': 'Q752',
'IRT687': 'Q753',
'IRT688': 'Q754',
'IRT689': 'Q755',
'IRT690': 'Q756',
'IRT691': 'Q757',
'IRT692': 'Q758',
'IRT693': 'Q759',
'IRT694': 'Q760',
'IRT695': 'Q761',
'IRT696': 'Q762',
'IRT697': 'Q763',
'IRT698': 'Q764',
'IRT699': 'Q765',
'IRT700': 'Q766',
'IRT701': 'Q767',
'IRT702': 'Q768',
'IRT703': 'Q769',
'IRT704': 'Q770',
'IRT705': 'Q771',
'IRT706': 'Q772',
'IRT707': 'Q773',
'IRT708': 'Q774',
'IRT709': 'Q775',
'IRT710': 'Q776',
'IRT711': 'Q777',
'IRT712': 'Q778',
'IRT713': 'Q779',
'IRT714': 'Q780',
'IRT715': 'Q781',
'IRT716': 'Q782',
'IRT717': 'Q783',
'IRT718': 'Q784',
'IRT719': 'Q785',
'IRT720': 'Q786',
'IRT721': 'Q787',
'IRT722': 'Q788',
'IRT723': 'Q789',
'IRT724': 'Q790',
'IRT725': 'Q791',
'IRT726': 'Q792',
'IRT727': 'Q793',
'IRT728': 'Q795',
'IRT729': 'Q796',
'IRT730': 'Q797',
'IRT731': 'Q798',
'IRT732': 'Q799',
'IRT733': 'Q800',
'IRT734': 'Q801',
'IRT735': 'Q802',
'IRT736': 'Q803',
'IRT737': 'Q804',
'IRT738': 'Q805',
'IRT739': 'Q806',
'IRT740': 'Q807',
'IRT741': 'Q808',
'IRT742': 'Q809',
'IRT743': 'Q810',
'IRT744': 'Q811',
'IRT745': 'Q812',
'IRT746': 'Q813',
'IRT747': 'Q814',
'IRT748': 'Q815',
'IRT749': 'Q816',
'IRT750': 'Q817',
'IRT751': 'Q818',
'IRT752': 'Q819',
'IRT753': 'Q820',
'IRT754': 'Q821',
'IRT755': 'Q822',
'IRT756': 'Q823',
'IRT757': 'Q824',
'IRT758': 'Q825',
'IRT759': 'Q826',
'IRT760': 'Q827',
'IRT761': 'Q828',
'IRT762': 'Q829',
'IRT763': 'Q830',
'IRT764': 'Q831',
'IRT765': 'Q832',
'IRT765a': 'Q833',
'IRT766': 'Q834',
'IRT767': 'Q835',
'IRT768': 'Q836',
'IRT768a': 'Q837',
'IRT769': 'Q838',
'IRT770': 'Q839',
'IRT771': 'Q840',
'IRT772': 'Q841',
'IRT773': 'Q842',
'IRT774': 'Q843',
'IRT775': 'Q844',
'IRT776': 'Q845',
'IRT777': 'Q846',
'IRT778': 'Q847',
'IRT779': 'Q848',
'IRT780': 'Q849',
'IRT781': 'Q850',
'IRT782': 'Q851',
'IRT783': 'Q852',
'IRT784': 'Q853',
'IRT785': 'Q854',
'IRT786': 'Q855',
'IRT787': 'Q856',
'IRT788': 'Q857',
'IRT789': 'Q858',
'IRT790': 'Q859',
'IRT790a': 'Q860',
'IRT791': 'Q861',
'IRT791a': 'Q862',
'IRT792': 'Q863',
'IRT793': 'Q864',
'IRT794': 'Q865',
'IRT795': 'Q866',
'IRT796': 'Q867',
'IRT797': 'Q868',
'IRT798': 'Q869',
'IRT798a': 'Q870',
'IRT799': 'Q871',
'IRT800': 'Q872',
'IRT800a': 'Q873',
'IRT801': 'Q874',
'IRT802': 'Q875',
'IRT803': 'Q876',
'IRT804': 'Q877',
'IRT805': 'Q878',
'IRT806': 'Q879',
'IRT807': 'Q880',
'IRT808': 'Q881',
'IRT809': 'Q882',
'IRT810': 'Q883',
'IRT811': 'Q884',
'IRT811a': 'Q885',
'IRT812': 'Q886',
'IRT813': 'Q887',
'IRT814': 'Q888',
'IRT815': 'Q889',
'IRT816': 'Q890',
'IRT817': 'Q891',
'IRT818': 'Q892',
'IRT819': 'Q893',
'IRT820': 'Q894',
'IRT821': 'Q895',
'IRT822': 'Q896',
'IRT823': 'Q897',
'IRT824': 'Q898',
'IRT825': 'Q899',
'IRT826': 'Q900',
'IRT827': 'Q901',
'IRT828': 'Q902',
'IRT829': 'Q903',
'IRT830': 'Q904',
'IRT831': 'Q905',
'IRT832': 'Q906',
'IRT833': 'Q907',
'IRT834': 'Q908',
'IRT835': 'Q909',
'IRT836': 'Q910',
'IRT837': 'Q911',
'IRT838': 'Q912',
'IRT839': 'Q913',
'IRT840': 'Q914',
'IRT841': 'Q915',
'IRT842': 'Q916',
'IRT843': 'Q917',
'IRT844': 'Q918',
'IRT845': 'Q919',
'IRT846': 'Q920',
'IRT847': 'Q921',
'IRT848': 'Q922',
'IRT849': 'Q923',
'IRT850': 'Q924',
'IRT851': 'Q925',
'IRT852': 'Q926',
'IRT853': 'Q927',
'IRT854': 'Q928',
'IRT856': 'Q929',
'IRT857': 'Q930',
'IRT858': 'Q931',
'IRT859': 'Q932',
'IRT860': 'Q933',
'IRT861': 'Q934',
'IRT862': 'Q935',
'IRT863': 'Q936',
'IRT864': 'Q937',
'IRT865': 'Q938',
'IRT866': 'Q939',
'IRT867': 'Q940',
'IRT868': 'Q941',
'IRT869': 'Q942',
'IRT870': 'Q943',
'IRT871': 'Q944',
'IRT872': 'Q945',
'IRT873': 'Q946',
'IRT874': 'Q947',
'IRT874a': 'Q948',
'IRT875': 'Q949',
'IRT876': 'Q950',
'IRT877': 'Q951',
'IRT877a': 'Q952',
'IRT878': 'Q953',
'IRT878a': 'Q954',
'IRT879': 'Q955',
'IRT880': 'Q956',
'IRT881': 'Q957',
'IRT882': 'Q958',
'IRT883': 'Q959',
'IRT884': 'Q960',
'IRT885': 'Q961',
'IRT886': 'Q962',
'IRT887': 'Q963',
'IRT888': 'Q964',
'IRT889': 'Q965',
'IRT890': 'Q966',
'IRT891': 'Q967',
'IRT892': 'Q968',
'IRT893': 'Q969',
'IRT894': 'Q970',
'IRT894a': 'Q971',
'IRT895': 'Q972',
'IRT896': 'Q973',
'IRT897': 'Q974',
'IRT898': 'Q975',
'IRT899': 'Q976',
'IRT900': 'Q977',
'IRT901': 'Q978',
'IRT902': 'Q979',
'IRT903': 'Q980',
'IRT904': 'Q981',
'IRT905': 'Q982',
'IRT906': 'Q983',
'IRT907': 'Q984',
'IRT908': 'Q985',
'IRT909': 'Q986',
'IRT910': 'Q987',
'IRT911': 'Q988',
'IRT912': 'Q989',
'IRT913': 'Q990',
'IRT914': 'Q991',
'IRT915': 'Q992',
'IRT916': 'Q993',
'IRT917': 'Q994',
'IRT918': 'Q995',
'IRT919': 'Q996',
'IRT920': 'Q997',
'IRT921': 'Q998',
'IRT922': 'Q999',
'IRT924': 'Q1000',
'IRT925': 'Q1001',
'IRT926': 'Q1002',
'IRT927': 'Q1003',
'IRT930': 'Q1004',
'IRT939a': 'Q1005',
'IRT939b': 'Q1006',
'IRT941': 'Q1007',
'IRT942': 'Q1008',
'IRT943': 'Q1009',
'IRT953': 'Q1010',
'IRT954': 'Q1011',
'IRT956': 'Q1012',
'IRT958': 'Q1013',
'IRT972': 'Q1014',
'IRT973': 'Q1015',
'IRT974': 'Q1016',
'IRT975': 'Q1017',
'IRT976': 'Q1018',
'IRT977': 'Q1019',
'IRT978': 'Q1020',
'IRT979': 'Q1021',
'IRT980': 'Q1022',
'IRT981': 'Q1023',
'IRT982': 'Q1024',
'IRT983': 'Q1025',
'IRT984': 'Q1026',
'IRT985': 'Q1027',
'IRT986': 'Q1028',
'IRT987': 'Q1029',
'IRT988': 'Q1030',
'IRT989': 'Q1031',
'IRT990': 'Q1032',
'IRT991': 'Q1033',
'IRT992': 'Q1034',
'IRT993': 'Q1035',
'IRT994': 'Q1036',
'IRT995': 'Q1037',
'IRT996': 'Q1038'
}


DATA_DIR = 'EAGLE-data/British School of Rome/'

LICENSE = "Creative Commons licence Attribution UK 2.0 (http://creativecommons.org/licenses/by/2.0/uk/). All reuse or distribution of this work must contain somewhere a link back to the URL http://irt.kcl.ac.uk/"

def main():
	always = dryrun = startsWith = False
	
	# Handles command-line arguments for pywikibot.
	for arg in pywikibot.handleArgs():
		if arg == '-dry': # Performs a dry run (does not edit site)
			dryrun = True
		if arg == '-always': # Does not ask for confirmation
			always = True
		if arg.startswith('-start:'): # Example: -start:IRT013
			startsWith = arg.replace('-start:', '')
	
	if not dryrun:
		# pywikibot/families/eagle_family.py
		site = pywikibot.Site('en', 'eagle').data_repository()
	
	
	for fileName in os.listdir(DATA_DIR):
		if startsWith:
			if fileName != (startsWith + '.xml'):
				continue # Skips files until start
			elif fileName == (startsWith + '.xml'):
				startsWith = False # Resets
		
		tree = ET.parse(DATA_DIR + fileName)
		root = tree.getroot()
		
		# Translation EN:
		try:
			site = pywikibot.Site('en', 'eagle').data_repository()
			transElem = root.findall('./text/body/div[@type=\'translation\']')[0]
			normalizeTranslation(transElem)
			translationEn = elementText(transElem)
			translationEn1 = translationEn[12:]

			irtid = re.search('(IRT\d{3}\w?)(.xml)', fileName).group(1)

			Q = irt[irtid]
			
			iteminwiki = pywikibot.ItemPage(site, Q)
			
			iteminwiki.get()
			
			if iteminwiki.claims:
				transinwiki = iteminwiki.claims[u'p11'][0].getTarget()	
				if transinwiki != translationEn1:
					pywikibot.output("\n>>>>> " + irtid + " <<<<<\n")
					pywikibot.output('old translation: ' + transinwiki)
					pywikibot.output('') # newline
					pywikibot.output('new translation: ' + translationEn1)
				else:
					continue

		except IndexError:
			pywikibot.output('WARNING: no translation found')
			continue # TODO: How should I handle this?
		
		
		pywikibot.output('') # newline
		
		if not always:
			choice = pywikibot.inputChoice(u"Proceed?",  ['Yes', 'No', 'All'], ['y', 'N', 'a'], 'N')
		else:
			choice = 'y'
		if choice in ['A', 'a']:
			always = True
			choice = 'y'
		if not dryrun and choice in ['Y', 'y']:
			iteminwiki.claims[u'p11'][0].changeTarget(translationEn1)
			
			

def elementText(elem):
	"""Gets inner element text, stripping tags of sub-elements."""
	text = ''.join(elem.itertext()).strip()
	text = re.sub('\n', ' ', text)
	text = re.sub('\s{2,}', ' ', text)
	return text

def normalizeTranslation(elem):
	"""Processes translation text"""
	
	# <gap />
	gaps = elem.findall('.//gap')
	for g in gaps:
		g.text = '[...]'
	
	# <note>
	notes = elem.findall('.//note')
	for n in notes:
		if n.text and n.text.startswith('Not usefully'): # Not usefully translat(a|ea)ble
			n.text = elementText(n)
		else:
			addBracesToElement(n, '(', ')')
	
	# <supplied>
	supplied = elem.findall('.//supplied')
	for s in supplied:
		addBracesToElement(s, '[', ']')

def addBracesToElement(elem, openBrace='(', closeBrace=')'):
	"""Encloses elem into braces."""
	if elem.text:
		elem.text = openBrace + elem.text
	else:
		elem.text = openBrace
	if elem.tail:
		elem.tail = closeBrace + elem.tail
	else:
		elem.tail = closeBrace

if __name__ == "__main__":
    try:
        main()
    finally:
        pywikibot.stopme()